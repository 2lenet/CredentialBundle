{% extends  "base.html.twig" %}

{% block page_title %}{{ 'title.admin_rights' | trans({}, 'CredentialBundle') }}{% endblock %}

{% block content %}
    <div class="page-header d-flex justify-content-between">
        <h2 class="title">{{ 'title.rights' | trans({}, 'CredentialBundle') }}</h2>
        <div class="">
            <a class="btn btn-secondary m-1" href="{{ load_url }}" target="_blank">
                {{ 'text.load_credential'| trans({}, 'CredentialBundle') }}
                <i class="fa fa-sync-alt"></i>
            </a>
            <a class="btn btn-secondary m-1" href="{{ crudit_studio_url }}" target="_blank">
                {{ 'text.redirect_crudit_studio'| trans({}, 'CredentialBundle') }}
                <i class="fa fa-external-link-alt"></i>
            </a>
        </div>
    </div>
    <style>
        .bundle-credential .table-striped > tbody > tr:nth-of-type(odd) {
            background-color: #DDD;
        }

        .bundle-credential .table {
            margin-bottom: 0px;
        }

        .bundle-credential .all-roles {
            width: 450px;
        }
    </style>

    <div class="bundle-credential box box-primary"
         style="border:1px solid #ccc; padding:5px; border-top:2px solid #3299DC;">

    {% set rubrique = '###' %}
    {% set rubriqueId = 0 %}
    {% for cred in credentials %}
        {% if rubrique != cred.rubrique %}
            {% set rubrique = cred.rubrique %}
            {% set rubriqueId = rubriqueId + 1 %}

            {% if not loop.first %}</table></div>{% endif %}

            <div style="background-color: #CECECE; text-align: center; padding:3px;"
                 class="collapsed m-1 py-1"
                 aria-expanded="false"
                 aria-controls="collapse-{{ rubriqueId }}"
                 data-bs-toggle="collapse"
                 data-bs-target="#{{ rubriqueId }}"
            >
                <strong class="card-toggle">
                    {{ rubrique }}
                </strong>
                <span class="card-toggle">
                <i class="fa fa-chevron-up"></i>
            </span>
            </div>

            <div class="collapse" id="{{ rubriqueId }}">
            <table class="table table-responsive table-bordered table-striped">
            <tr class="rubrique-groupe-data-{{ rubriqueId }}">
                <th class="all-roles" style="width: 450px;">{{ 'title.all_roles' | trans({}, 'CredentialBundle') }}</th>
                {% for group in groupes %}
                <th style="background-color: #e2dfdf; vertical-align: bottom" title="{{ group.libelle ?? group.name|lower|humanize }}">
                    <div style="writing-mode: vertical-lr;">{{ group.libelle ?? group.name|lower|humanize }}&nbsp;
                    </div>
                    {% endfor %}
            </tr>
        {% endif %}
        <tr class="rubrique-groupe-data-{{ rubriqueId }}">
            <th>
                <span title="{{ cred.role }}">{{ cred.libelle|trans({}, 'CredentialBundle') }}</span>
                {% if cred.listeStatus %}
                    <hr class="m-1">
                    {{ 'title.status_allowed' | trans({}, 'CredentialBundle') }}
                    <button class="p-0 float-end btn btn-sm btn-tranparent" type="button" data-bs-toggle="collapse"
                            data-bs-target=".multi-collapse-{{ cred.role }}" aria-expanded="false"
                            aria-controls="status-list-{{ cred.role }} checkboxes-status-list-{{ cred.role }}">
                        <i class="fas fa-angle-down"></i>
                    </button>
                    <div class="collapse multi-collapse multi-collapse-{{ cred.role }}"
                         id="status-list-{{ cred.role }}">
                        {% for status in cred.listeStatus %}
                            <div>
                                {{ status|capitalize }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </th>
            {% for group in groupes %}
                <td>
                    {% if actives[group.name ~ '-' ~ cred.role] ?? false %}
                        <i class="fas fa-check-circle" style="color: #18CC1E;"></i>
                    {% else %}
                        <i class="far fa-times-circle" style="color: #CC0A0A;"></i>
                    {% endif %}
                    {% if cred.listeStatus %}
                        <hr class="m-1">
                        {% if statusAllowed[group.name ~ '-' ~ cred.role] ?? false %}
                            <i class="fas fa-check-circle" style="color: #18CC1E;"></i>
                        {% else %}
                            <i class="far fa-times-circle" style="color: #CC0A0A;"></i>
                        {% endif %}
                        <div class="collapse multi-collapse multi-collapse-{{ cred.role }}"
                             id="checkboxes-status-list-{{ cred.role }}">
                            <div
                                class="{% if not statusAllowed[group.name ~ '-' ~ cred.role] ?? false %} d-none {% endif %}"
                                id="show-all-status-checkboxes-{{ group.name }}-{{ cred.role }}">
                                {% for status in cred.listeStatus %}
                                    <div>
                                        {% if actives[group.name ~ '-' ~ cred.role ~ '_' ~ status|upper] ?? false %}
                                            <i class="fas fa-check-circle" style="color: #18CC1E;"></i>
                                        {% else %}
                                            <i class="far fa-times-circle" style="color: #CC0A0A;"></i>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                </td>
            {% endfor %}
        </tr>
    {% endfor %}
    </table>
    </div>
{% endblock %}
